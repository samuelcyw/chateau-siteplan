<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Regency Site Plan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100vw;
      min-height: 100vh;
      font-family: 'Segoe UI', 'Arial', sans-serif;
      background: #f6f8fa;
      overflow-x: hidden;
    }
    .brand-logo-container {
      width: 100vw;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 32px;
      margin-bottom: 8px;
    }
    .brand-logo {
      max-width: 240px;
      width: 18vw;
      min-width: 120px;
      height: auto;
      background: #fff;
      border-radius: 24px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.04);
      padding: 12px 24px;
      transition: box-shadow 0.2s;
    }
    .brand-logo:hover {
      box-shadow: 0 8px 36px rgba(0,0,0,0.10);
    }
    #floorplan-container {
      width: 100vw;
      max-width: 100vw;
      margin: 0;
      padding: 0;
      border: none;
      background: #fff;
      overflow-x: auto;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 64vh;
      box-shadow: none;
      border-radius: 0;
    }
    #floorplan-container svg {
      display: block;
      width: 100vw !important;
      max-width: 100vw !important;
      min-width: 0 !important;
      height: auto !important;
      aspect-ratio: 16/9;
      margin: 0 auto;
      border-radius: 0;
      box-shadow: none;
    }
    /* Modal styles */
    #unit-modal {
      position: fixed; left: 0; top: 0; width: 100vw; height: 100vh;
      display: none; align-items: center; justify-content: center;
      z-index: 9999; pointer-events: none;
    }
    #unit-modal .modal-overlay {
      position: absolute; left: 0; top: 0; width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.26); pointer-events: all;
    }
    #unit-modal .modal-content {
      position: relative;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 16px 48px rgba(0,0,0,0.13);
      max-width: 94vw; width: 370px; padding: 30px 26px 18px 26px;
      z-index: 2; pointer-events: all;
      animation: fadeInModal .27s;
    }
    @keyframes fadeInModal { from { opacity: 0; transform: translateY(40px);} to {opacity:1; transform: none;}}
    #modal-close-btn {
      position: absolute; right: 18px; top: 12px; border: none; background: none;
      font-size: 1.9em; cursor: pointer; color: #888;
      transition: color .13s;
    }
    #modal-close-btn:hover { color: #222;}
    #modal-details {
      margin-top: 12px;
      font-size: 1.1em;
      line-height: 1.7;
    }
    #unit-modal[style*='display: flex'] { pointer-events: all;}
    @media (max-width: 800px) {
      .brand-logo-container {
        margin-top: 16px;
        margin-bottom: 4px;
      }
      #floorplan-container {
        min-height: 40vh;
        margin-bottom: 14px;
      }
      #unit-modal .modal-content {
        width: 95vw;
        min-width: 0;
        padding: 18px 8vw 16px 8vw;
      }
    }
  </style>
</head>
<body>
  <!-- Brand Logo -->
  <div class="brand-logo-container">
    <img class="brand-logo"
      src="https://www.dropbox.com/scl/fi/b5dl86x1foeds8svh5c73/Logo-Regency.png?rlkey=3fe9mjacnnpuzvaxd9ytpaut9&st=dx3j8n2h&dl=1"
      alt="Regency Brand Logo">
  </div>

  <!-- FULL WIDTH Siteplan SVG loads here by JS -->
  <div id="floorplan-container"></div>

  <!-- Modal for customer data -->
  <div id="unit-modal" style="display:none;">
    <div class="modal-overlay"></div>
    <div class="modal-content">
      <button id="modal-close-btn">&times;</button>
      <div id="modal-details"></div>
    </div>
  </div>

  <script>
    // --- UPDATE THIS SVG URL WITH YOUR GITHUB RAW LINK ---
    const SITEPLAN_SVG_URL = 'https://raw.githubusercontent.com/your-username/your-repo/main/path/to/siteplan.svg'; // <--- replace this!
    const CUSTOMER_JSON_URL = 'https://www.dropbox.com/scl/fi/9tgtfvjsf2xp262eqvr5v/customerdata.json?rlkey=c9hocv3qndpuux8flfrzlv7ky&raw=1';
    const STATUS_JSON_URL = 'https://www.dropbox.com/scl/fi/zptyn3as4w9h9ao9smdy5/status.json?rlkey=g1gumloy76bw7m7atftifnxt8&raw=1';

    const STATUS_COLOR = {
      "Available": "#CCEEEE",
      "Reserved": "orange",
      "Duplicate": "#FFD700",
      "Sold": "#FF7F7F"
    };

    let customerData = [];
    fetch(CUSTOMER_JSON_URL)
      .then(res => res.json())
      .then(data => {
        if (data.Data && data.Data[0] && data.Data[0].array) {
          customerData = data.Data[0].array;
        } else if (Array.isArray(data)) {
          customerData = data;
        }
      });

    function loadSiteplan() {
      fetch(SITEPLAN_SVG_URL)
        .then(res => res.text())
        .then(svg => {
          document.getElementById('floorplan-container').innerHTML = svg;
          fetchStatusAndUpdate();
        });
    }

    function fetchStatusAndUpdate() {
      fetch(STATUS_JSON_URL)
        .then(res => res.json())
        .then(data => {
          const units = data['Array Aggregator output'] || [];
          units.forEach(unit => {
            const id = unit.unitID || unit.unitId;
            const status = unit.status;
            const shape = document.getElementById(`${id}-shape`);
            if (shape && STATUS_COLOR[status]) {
              shape.setAttribute('fill', STATUS_COLOR[status]);
              shape.style.cursor = "pointer";
              shape.onclick = (evt) => showUnitModal(id);
            }
          });
        })
        .catch(err => {
          console.error("Error loading status JSON:", err);
        });
    }

    function showUnitModal(unitId) {
      // Find the customer data for this unit
      const data = customerData.find(u => (u.unitId || u.unitID) === unitId);
      let html = `<b>Unit: ${unitId.replace("unit","")}</b><br>`;
      if (!data) {
        html += "<em>No data available.</em>";
      } else {
        if (data.status) html += `<b>Status:</b> ${data.status}<br>`;
        if (data["Customer Name"]) html += `<b>Customer:</b> ${data["Customer Name"]}<br>`;
        if (data["Sold Price"]) html += `<b>Sold Price:</b> $${data["Sold Price"]}<br>`;
        if (data["Reserved Date"]) html += `<b>Reserved Date:</b> ${data["Reserved Date"]}<br>`;
        if (data["Sold Date"]) html += `<b>Sold Date:</b> ${data["Sold Date"]}<br>`;
        if (data["Payment Record"]) html += `<b>Payment:</b> ${data["Payment Record"]}<br>`;
        if (data["Contract "]) html += `<b>Contract:</b> ${data["Contract "]}<br>`;
        if (data["Customer Worksheet"]) html += `<b>Worksheet:</b> ${data["Customer Worksheet"]}<br>`;
        if (data["Block"]) html += `<b>Block:</b> ${data["Block"]}<br>`;
      }
      document.getElementById('modal-details').innerHTML = html;
      document.getElementById('unit-modal').style.display = 'flex';
    }

    document.addEventListener("DOMContentLoaded", function(){
      document.getElementById('modal-close-btn').onclick = () => {
        document.getElementById('unit-modal').style.display = 'none';
      };
      document.querySelector('#unit-modal .modal-overlay').onclick = () => {
        document.getElementById('unit-modal').style.display = 'none';
      };
    });

    // Initial load
    loadSiteplan();
    // Refresh siteplan every 60 seconds (60000 ms)
    setInterval(loadSiteplan, 60000);
  </script>
</body>
</html>
