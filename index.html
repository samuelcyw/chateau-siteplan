<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Regency Site Plan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100vw;
      min-height: 100vh;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f6f8fa;
      overflow-x: hidden;
    }
    .brand-logo-container {
      width: 100vw;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 32px 0 8px;
    }
    .brand-logo {
      max-width: 240px;
      width: 18vw;
      min-width: 120px;
      background: #fff;
      border-radius: 24px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.04);
      padding: 12px 24px;
      transition: box-shadow .2s;
    }
    .brand-logo:hover { box-shadow: 0 8px 36px rgba(0,0,0,0.10); }

    #floorplan-container {
      width: 100vw;
      max-width: 100vw;
      margin: 0;
      padding: 0;
      background: #fff;
      overflow-x: auto;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 64vh;
    }
    #floorplan-container svg {
      display: block;
      width: 100vw !important;
      max-width: 100vw !important;
      height: auto !important;
      aspect-ratio: 16/9;
      margin: 0 auto;
    }

    /* Modal styles */
    #unit-modal {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      pointer-events: none;
    }
    #unit-modal .modal-overlay {
      position: absolute;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.26);
      pointer-events: all;
    }
    #unit-modal .modal-content {
      position: relative;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 16px 48px rgba(0,0,0,0.13);
      max-width: 94vw;
      width: 370px;
      padding: 30px 26px 18px;
      z-index: 2;
      pointer-events: all;
      animation: fadeInModal .27s;
    }
    @keyframes fadeInModal {
      from { opacity: 0; transform: translateY(40px); }
      to   { opacity: 1; transform: none; }
    }
    #modal-close-btn {
      position: absolute;
      top: 12px; right: 18px;
      border: none;
      background: none;
      font-size: 1.9em;
      cursor: pointer;
      color: #888;
      transition: color .13s;
    }
    #modal-close-btn:hover { color: #222; }
    #modal-details {
      margin-top: 12px;
      font-size: 1.1em;
      line-height: 1.6;
    }
    @media (max-width: 800px) {
      #unit-modal .modal-content {
        width: 95vw;
        padding: 18px 8vw 16px;
      }
    }
  </style>
</head>
<body>
  <div class="brand-logo-container">
    <img class="brand-logo"
      src="https://www.dropbox.com/scl/fi/b5dl86x1foeds8svh5c73/Logo-Regency.png?dl=1"
      alt="Regency Brand Logo" />
  </div>

  <div id="floorplan-container"></div>

  <div id="unit-modal">
    <div class="modal-overlay"></div>
    <div class="modal-content">
      <button id="modal-close-btn">&times;</button>
      <div id="modal-details"></div>
    </div>
  </div>

  <script>
    const STATUS_COLOR = {
      Available:  '#CCEEEE',
      Reserved:   'orange',
      Duplicate:  '#FFD700',
      Sold:       '#FF7F7F'
    };

      const CUSTOMER_JSON_URL =
    'https://dl.dropboxusercontent.com/scl/fi/9tgtfvjsf2xp262eqvr5v/customerdata.json?raw=1';
  const STATUS_JSON_URL =
    'https://dl.dropboxusercontent.com/scl/fi/zptyn3as4w9h9ao9smdy5/status.json?raw=1';

    let customerData = [];
    fetch(CUSTOMER_JSON_URL)
      .then(res => res.json())
      .then(data => {
        customerData = data.Data?.[0]?.array || (Array.isArray(data) ? data : []);
      })
      .catch(err => console.error('Customer JSON error:', err));

    function loadSiteplan() {
      fetch('siteplan.svg')
        .then(res => res.text())
        .then(svg => {
          document.getElementById('floorplan-container').innerHTML = svg;
          applyStatusAndClicks();
        })
        .catch(err => console.error('SVG load error:', err));
    }

    function applyStatusAndClicks() {
      fetch(STATUS_JSON_URL)
        .then(res => res.json())
        .then(data => {
          const units = data['Array Aggregator output'] || [];
          units.forEach(u => {
            const id = u.unitId;
            const shape = document.getElementById(id + '-shape');
            if (shape && STATUS_COLOR[u.status]) {
              shape.setAttribute('fill', STATUS_COLOR[u.status]);
              shape.style.cursor = 'pointer';
              shape.onclick = () => showUnitModal(id);
            }
          });
        })
        .catch(err => console.error('Status JSON error:', err));
    }

    function showUnitModal(unitId) {
      const u = customerData.find(x => x.unitId === unitId);
      let html = `<strong>Unit ${unitId.replace('unit','')}</strong><br>`;
      if (!u) {
        html += '<em>No data available.</em>';
      } else {
        ['status','Customer Name','Sold Price','Reserved Date','Sold Date',
         'Payment Record','Contract ','Customer Worksheet','Block']
        .forEach(field => {
          if (u[field]) {
            html += `<b>${field.replace(/(^\w|\s\w)/g,c=>c.toUpperCase())}:</b> ${u[field]}<br>`;
          }
        });
      }
      document.getElementById('modal-details').innerHTML = html;
      document.getElementById('unit-modal').style.display = 'flex';
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('modal-close-btn').onclick = () => {
        document.getElementById('unit-modal').style.display = 'none';
      };
      document.querySelector('#unit-modal .modal-overlay').onclick = () => {
        document.getElementById('unit-modal').style.display = 'none';
      };
    });

    loadSiteplan();
    setInterval(loadSiteplan, 60000);
  </script>
</body>
</html>
